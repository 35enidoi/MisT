# 翻訳を作成するには

> [!WARNING]  
polibというライブラリが必要です。

## メインプログラムから翻訳したい文字列を別ファイルに移動

1. まず、メインプログラムで翻訳する文字のあるシーン別に`textenum`ディレクトリに`<scenename>_txts.py`として作成。  
    1. 別に`<scenename>_txts.py`として作らなくても名前は適当で大丈夫ですが、その方が統一感あるのでできるだけそうしてください。

2. 次に、そのpythonプログラム内にクラスを作成。
    1. 名前は何でもよいですが、シーンの名前がわかりやすい、それでいて少ない文字列にした方が良いです。例えば、`CreateNote`シーンであれば`CN_T`です。
    2. このクラスには`Enum`を継承させてください。
    3. また、下の関数をクラス内に**必ず**作ってください。(コピーすればよいです。)
    ```py
    def __getattribute__(self, __name: str) -> Any:
        if __name == "value":
            return _(super().__getattribute__(__name))
        return super().__getattribute__(__name)
    ```
    4. `textenums/__init__.py`にこのクラスを`import`する文を追加してください。じゃないと使えません。

3. 翻訳する文字を変数としてこのクラス内に置いていく
    1. 翻訳する文字を`Enum`として使うからです。
    2. 例:
    ```
    HONI = "honi"
    ```

4. 文字をこのクラスから変数を通して`.value`で受け取る
    1. **絶対**に`.value`を付けて受け取ってください。動きません。
    2. 例:(翻訳対象の文字をクラス`EXAMPLE_T`に`HONYAKU_TXT`として変数を定義した場合)  
    ```
    EXAMPLE_T.HONYAKU_TXT.value
    ```

## potファイル更新
スクリプト`gettext_fromtextenum.py`を用いる。  

使い方は簡単。
```
python gettext_fromtextenum.py
```
これを実行するだけ。  

あとは変更点が表示されるので確認しながら`yes`あるいは`y`と入力してれば`messages.pot`が更新される。

## poファイル、moファイル作成（対話的）
スクリプト`create_msg.py`を用いて対話的にpoファイル、moファイルの作成、更新ができるようになりました。

### 使い方
1. `python create_msg.py`を実行

2. 名前を聞かれるので名前を入力

3. 翻訳する言語のファイル名を入力
    1. 例えば、`ja_JP`等のファイル名です。
    2. この後ファイルの確認を行い、もし存在して、かつ**最後の編集者の名前と入力された名前が異なる場合**、変更してよいか確認をします。
    3. もしファイルが存在しない場合、新しくファイルを作成します。

4. もし、削除するものがあった場合(potファイル内に存在しないmsgidがあった場合)、削除対象を表示し、自動で削除します。

5. もし、追加するものがあった場合(potファイル内に存在するmsgidがない場合)、翻訳作業を開始します。
    1. 翻訳作業は対話的に行われます。
    2. 上から、翻訳する対象の残りの数、このIDを参照している変数名、msgidが表示されます。
    3. これらを見て、翻訳した値を入力してください。入力する部分は`msgstr:`という感じになっています。
    4. 入力された値に対して、ブラケット`{}`の数が**一致**するか確認してくれます。もし数がmsgidと違っているともう一度入力を促します。

6. フラッグとタイムスタンプを変更し、言語ファイルを自動でpoファイル、moファイルに保存します。
    1. フラッグは`#,`から始まってるコメントです。

7. 完了

### 注意点
**エスケープシーケンスはエスケープされてしまいます。**  
エスケープがエスケープってどういうこと？という感じですが、`polib`の仕様上`\n`や`\r`といったエスケープシーケンスは自動で`\\n`や`\\r`にされてしまいます。  
このエスケープを直すには、手動でのpoファイルの編集をする必要があります。  

### 手動でpoファイルの手直し、編集
上の対話的なファイル作成は、対話的に新たに追加された文字の翻訳作業をする役割と、自動で使われない文字を削除する機能だけしかないので、既存の文字の編集や手直しなどをしたい場合はpoファイルを手動で書き換えする必要があります。  

編集後、moファイルへの変換は`python create_msg.py`を実行し、名前と対象言語のファイル名を入力すれば行われます。  